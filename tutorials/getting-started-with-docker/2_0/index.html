<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Knot.x Website">
  <meta name="keywords" content="knotx, vertx, reactive, asynchronous, templating, java, polyglot, cms, tutorial">
  <title>Getting Started with Docker</title>

  <meta property="og:title" content="Getting Started with Docker"/>
  <meta property="og:type" content="article"/>
  <meta property="og:url" content="http://knotx.io/tutorials/getting-started-with-docker/2_0/"/>
  <meta property="og:site_name" content="Knot.x Website"/>
  <meta property="og:description" content="Knot.x Website"/>
  <meta property="og:image" content="http://knotx.io/img/logo-240x240.png"/>

  <link rel="apple-touch-icon" sizes="57x57" href="/img/favicons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/favicons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/favicons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/favicons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/favicons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/favicons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/favicons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/favicons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicons/favicon-16x16.png">
  <link rel="manifest" href="/img/favicons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/img/favicons/ms-icon-144x144.png">
  <meta name="theme-color" content="#9f136c">

  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Montserrat:200,300,400,500,700|Ubuntu:300,400,500,700" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link  rel="stylesheet" href="/styles/bootstrap.css" /><link  rel="stylesheet" href="/styles/github.css" /><link  rel="stylesheet" href="/styles/knotx.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

  <body >
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92165781-1', 'auto');
  ga('send', 'pageview');

</script>
    <!-- Header -->
<header class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/img/logo-knotx.png" class="navbar-brand-logo" alt="Knot.x Logo"/>
      </a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        
        <li><a href="/download/">Download</a></li>
        
        <li><a href="/tutorials/">Tutorials</a></li>
        
        <li><a href="https://github.com/Knotx/knotx/issues">Issues</a></li>
        
        <li><a href="/documentation/">Documentation</a></li>
        
        <li><a href="/community/">Community</a></li>
        
        <li><a href="/blog/">Blog</a></li>
        
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</header>

    <!-- Content Header -->
<div class="content-header">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <h1>Getting Started with Docker</h1>
      </div>
    </div>    
  </div>
  
</div>

<div class="container flex blog">
    <div class="row">
      <div class="col-sm-12">
        <article>
          <header class="meta">
  <a class="meta-item" href="https://github.com/marcinkp">Piotr Marcinkowski</a>
  <time class="meta-item date"
        datetime="2019-08-07">August 7th, 2019
  </time>

  <div class="post-versions">    
    
      <a class="post-btn" href="/tutorials/getting-started-with-docker/2_0/">2.0.0</a>
    
  </div>
</header>

          <section class="post">
            <h2 id="overview">Overview</h2>
<p>In this tutorial, we will setup a simple project based on the <a href="https://github.com/Knotx/knotx-starter-kit">Knot.x Starter Kit</a> template.
Will configure Knot.x with a simple page that uses an external datasource (Google Books API) to fetch the dynamic data and display it on our page.</p>
<p>What you’re going to learn:</p>
<ul>
<li>How to setup a Knot.x project with customization based on the <a href="https://github.com/Knotx/knotx-starter-kit">Knot.x Starter Kit</a> template</li>
<li>How to transform a static HTML into the dynamic content and configure Knot.x to use REST services to get data</li>
<li>How to use the data from such services to dynamically populate HTML</li>
</ul>
<h2 id="setup-basic-knot-x-project">Setup basic Knot.x project</h2>
<p><strong>Prerequisites</strong>
You will need the following things to use Knot.x:</p>
<ul>
<li>JDK 8</li>
<li>Docker </li>
</ul>
<p>Download the <a href="https://github.com/Knotx/knotx-starter-kit/releases">Latest Knot.x Starter Kit release</a> and unzip it.</p>
<p>Project has the following structure:</p>
<pre class="highlight"><code class="hljs lasso">├── docker
|   ├── Dockerfile                <span class="hljs-comment">// Docker file with image definition.</span>
├── functional                    <span class="hljs-comment">// Keep here your functional tests. Example implementation included</span>
├── gradle                        <span class="hljs-comment">// Gradle wrapper and common gradle scripts</span>
├── knotx/conf                    <span class="hljs-comment">// Knotx configurations which will be copied to docker image</span>
├── modules                       <span class="hljs-comment">// Sub-modules of your project</span>
│   ├── <span class="hljs-params">...</span>                       <span class="hljs-comment">// example modules implementation</span></code></pre><h2 id="configuration">Configuration</h2>
<p>Let&#39;s now configure Knot.x to do the magic for us.
We need to do two things:</p>
<ul>
<li>provide the page template, for the tutorial purpose, we will use <a href="https://github.com/Knotx/knotx-repository-connector/tree/master/fs"><code>fsRepoConnectorHandler</code></a>,</li>
<li>provide the datasource, we will use the <a href="https://developers.google.com/books/">Google Books API</a>.</li>
</ul>
<blockquote>
<p>All configuration options and default values, for each Knot.x module, are
described on github. For example <a href="https://github.com/Knotx/knotx-repository-connector/blob/master/fs/docs/asciidoc/dataobjects.adoc"><code>fsRepoConnectorHandler</code> configuration</a></p>
</blockquote>
<h3 id="html-template">HTML Template</h3>
<p>Create a <code>knotx/repository/content</code> directory in your project and put there following page template with Knot.x snippet (<code>&lt;knotx:snippet data-knotx-task=&quot;bookslist&quot;&gt;...</code>):</p>
<p><em>books.html</em></p>
<pre class="highlight"><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Knot.x<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://bootswatch.com/4/superhero/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-12"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-default"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span>Books list<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span>
          This page lists Java related books provided by <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
            <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.googleapis.com/books/v1/volumes?q=java"</span>&gt;</span>Googleapis book service<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">knotx:snippet</span> <span class="hljs-attr">data-knotx-task</span>=<span class="hljs-string">"bookslist"</span>&gt;</span>
      {{#each books._result.items}}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-sm-3"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img-top"</span>
             <span class="hljs-attr">src</span>=<span class="hljs-string">"{{volumeInfo.imageLinks.thumbnail}}"</span>
             <span class="hljs-attr">alt</span>=<span class="hljs-string">"{{volumeInfo.title}}"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-block"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>{{volumeInfo.title}}<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>
              {{#each volumeInfo.authors as |author|}}
                {{author}}{{#unless @last}}, {{/unless}}
              {{/each}}<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>
              Published: {{volumeInfo.publishedDate}}
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {{/each}}
    <span class="hljs-tag">&lt;/<span class="hljs-name">knotx:snippet</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
<h3 id="templates-repository-configuration">Templates repository configuration</h3>
<p>We will use <a href="https://github.com/Knotx/knotx-repository-connector/tree/master/fs">fsRepoConnectorHandler</a>, its purposes are purely academical.
It is not designed to be used as a production ready solution (you should use <a href="https://github.com/Knotx/knotx-repository-connector/tree/master/http">httpRepoConnectorHandler</a> there).</p>
<p>Create <code>knotx/conf/routes/handlers/fsRepoConnectorHandler.conf</code> file with the following:</p>
<pre class="highlight"><code class="hljs ruby"><span class="hljs-comment"># Path to the directory on the local filesystem which will be the root for requested templates</span>
catalogue = <span class="hljs-string">"/usr/local/knotx/repository/"</span></code></pre>
<p>This way we define the <code>repository</code> directory that will be our files content repository.</p>
<h3 id="openapi-yml">openapi.yml</h3>
<p>Open <code>knotx/conf/openapi.yml</code> and add following path definition:</p>
<pre class="highlight"><code class="hljs dts">  <span class="hljs-meta-keyword">/content/</span>*:
<span class="hljs-symbol">    get:</span>
<span class="hljs-symbol">      operationId:</span> content-get
<span class="hljs-symbol">      responses:</span>
<span class="hljs-symbol">        default:</span>
<span class="hljs-symbol">          description:</span> Remote repository template processing</code></pre><p>By doing this you define the operation which should be executed for path <code>/content/*</code>.</p>
<h3 id="operations-conf">operations.conf</h3>
<p>Now, you need to define operation <code>content-get</code>. Open <code>knotx/conf/routes/operations.con</code>
Add in <code>routingOperations</code> array following definition:</p>
<pre class="highlight"><code class="hljs routeros">  {
    operationId = content-<span class="hljs-builtin-name">get</span>
    handlers = <span class="hljs-variable">${config.server.handlers.common.request}</span> [
      {
        name = fsRepoConnectorHandler
       <span class="hljs-built_in"> config </span>= {include required(classpath(<span class="hljs-string">"routes/handlers/fsRepoConnectorHandler.conf"</span>))}
      },
      {
        name = htmlFragmentsSupplier
      },
      {
        name = fragmentsHandler
       <span class="hljs-built_in"> config </span>= {include required(classpath(<span class="hljs-string">"routes/handlers/fragmentsHandler.conf"</span>))}
      },
      {
        name = fragmentsAssembler
      }
    ] <span class="hljs-variable">${config.server.handlers.common.response}</span>
  }</code></pre><h3 id="task-configuration">Task configuration</h3>
<p>As you probably noticed the <code>Knot.x</code> snippet you defined in the <code>books.html</code> template file pointed to the <code>bookslist</code> task. Let&#39;s define it.</p>
<p>Create <code>knotx/conf/routes/handlers/fragmentsHandler.conf</code> and add following code:</p>
<pre class="highlight"><code class="hljs ruby">tasks {
  bookslist {
    action = books
    onTransitions {
      _success {
        action = te-hbs
      }
    }
  }
}

actions {
  books {
    factory = http
    config {
      endpointOptions {
        path = <span class="hljs-string">"/books/v1/volumes?q=java"</span>
        domain = www.googleapis.com
        port = <span class="hljs-number">443</span>
        allowedRequestHeaders = [<span class="hljs-string">"Content-Type"</span>]
      }
      webClientOptions {
        ssl = <span class="hljs-literal">true</span>
      }
    }
  }
  te-hbs {
    factory = knot
    config {
      address = knotx.knot.te.handlebars
      deliveryOptions {
        sendTimeout = <span class="hljs-number">1000</span>
      }
    }
  }
}</code></pre>
<p>Above file will be processed by <a href="https://github.com/Knotx/knotx-fragments/tree/master/handler"><code>fragmentsHandler</code></a>. 
We will cover more sophisticated example in the <a href="/tutorials/configurable-api-gateway/">configurable API gateway tutorial</a> </p>
<h2 id="docker">Docker</h2>
<h3 id="configuration">Configuration</h3>
<p><a href="https://github.com/Knotx/knotx-starter-kit">Knot.x Starter Kit</a> project builds docker image. Edit <code>gradle.properties</code> and change property <code>docker.image.name</code>:</p>
<pre class="highlight"><code class="hljs stylus">docker<span class="hljs-selector-class">.image</span><span class="hljs-selector-class">.name</span>=knotx-example/docker-distribution</code></pre><h2 id="run">Run</h2>
<p>Now we are ready to run. First, build your docker image</p>
<pre class="highlight"><code class="hljs elixir"><span class="hljs-variable">$ </span>gradlew clean build</code></pre><p>Run Knot.x instance:</p>
<pre class="highlight"><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="bash"> -p8092:8092 knotx-example/docker-distribution</span></code></pre><p>The last thing left, open <a href="http://localhost:8092/content/books.html">http://localhost:8092/content/books.html</a> - Voilà!</p>

          </section>
        </article>
        <div id="disqus_thread"></div>
        <script>
        var disqus_config = function () {
        this.page.url = "http://knotx.io/tutorials/getting-started-with-docker/2_0/";
        this.page.identifier = "dd0032754bd1676e7fb076a125db3a1d";
        };
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//knotx-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </div>
</div>
    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-6">
         <p>Knot.x is <a href="https://github.com/Knotx/knotx">open source</a> and is licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache 2.0 License</a>.</p>
      </div>
      <div class="col-sm-5 col-sm-offset-1 text-right">
        <p>Knot.x is brought to you with the support of <img src="/img/Cognified_Logo_white.png" alt="Cognifide"/></p>
      </div>
    </div>
  </div>
</footer>
<script defer="defer"  src="/scripts/vendor/jquery.min.js"></script><script defer="defer"  src="/scripts/vendor/bootstrap.min.js"></script><script defer="defer"  src="/scripts/vendor/highlight.pack.js"></script><script defer="defer"  src="/scripts/knotx.js"></script><script defer="defer"  src="/scripts/vendor/jquery.qtip.min.js"></script><script defer="defer"  src="/scripts/hovermap.js"></script>


  </body>
</html>